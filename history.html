<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</title>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    td input {
      width: 100%;
    }
  </style>
</head>
<body>
  <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
  <table id="dataTable">
    <thead>
      <tr>
        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
        <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
        <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
        <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <p style="margin-top:40px;">
    üîô <a href="index.html">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</a>
  </p>

  <script>
    async function loadData() {
      const res = await fetch('/get_data');
      const data = await res.json();
      const tbody = document.querySelector('#dataTable tbody');
      tbody.innerHTML = '';
      data.forEach((row, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input value="${row[0] || ''}"></td>
          <td><input value="${row[1] || ''}"></td>
          <td><input value="${row[2] || ''}"></td>
          <td><input value="${row[3] || ''}"></td>
          <td><input value="${row[4] || ''}"></td>
          <td>
            <button onclick="updateRow(${index}, this)">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            <button onclick="deleteRow(${index})">‡∏•‡∏ö</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function deleteRow(index) {
      if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
      await fetch('/delete_row', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ index })
      });
      loadData();
    }

    async function updateRow(index, btn) {
      const row = btn.closest('tr');
      const inputs = row.querySelectorAll('input');
      const newData = {
        index,
        date: inputs[0].value,
        item: inputs[1].value,
        amount: inputs[2].value,
        category: inputs[3].value,
        note: inputs[4].value
      };
      await fetch('/update_row', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(newData)
      });
      alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
      loadData();
    }

    loadData();
  </script>
</body>
</html>
